{"version":3,"file":"transformer.js","sourceRoot":"","sources":["../../src/components/transformer.ts"],"names":[],"mappings":"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","sourcesContent":["import dayjs from 'dayjs';\nimport utc from 'dayjs/plugin/utc';\nimport duration from 'dayjs/plugin/duration'; // import plugin\n\ndayjs.locale('nl');\ndayjs.extend(utc);\ndayjs.extend(duration);\n\nimport {\n  VtbData,\n  VtbElement,\n  VtbElementGroup,\n  VtbExtraField,\n  VtbFlight,\n  VtbFlightCarrier,\n  VtbFlightData,\n  VtbGeoLocation,\n  VtbMedia,\n  VtbParticipant,\n  VtbParticipantPrice,\n  VtbParty,\n} from './data';\n\nexport class VtbDataTransformer {\n  private _data = new VtbData();\n\n  parse_vtb_data(\n    vtbSrcData: any // eslint-disable-line @typescript-eslint/no-explicit-any\n  ) {\n    // search and setup base info\n    this._data.title = vtbSrcData.title;\n    this._data.subtitle = vtbSrcData.subtitle || '';\n    this._data.start_date = dayjs.utc(vtbSrcData.startDate);\n    this._data.end_date = dayjs.utc(vtbSrcData.endDate);\n    this._data.duration = vtbSrcData.totalDays;\n    this._data.sales_price = vtbSrcData.salesPriceAfterRounding;\n\n    // search and setup participants and parties\n    for (const party_id of Object.keys(vtbSrcData.participants)) {\n      const participants = vtbSrcData.participants[party_id];\n\n      const _party = new VtbParty();\n      _party.id = party_id;\n\n      for (const pax of participants) {\n        const _pax = new VtbParticipant();\n        _pax.id = pax.id;\n        _pax.title = pax.title;\n        _pax.name = pax.name;\n        _pax.prefix = pax.surname_prefix;\n        _pax.surname = pax.surname;\n        _pax.birthdate = dayjs(pax.birthdate);\n\n        this._data.participants[pax.id] = _pax;\n        _party.participants?.push(_pax);\n      }\n\n      this._data.parties[party_id] = _party;\n    }\n\n    // search and setup covers (can be 0 or more!)\n    if (vtbSrcData.cover && vtbSrcData.cover.length >= 1) {\n      for (const src of vtbSrcData.cover) {\n        const _media = new VtbMedia();\n        _media.src = src.url;\n        _media.id = src.sourceId;\n        _media.tags = src.tags;\n\n        this._data.covers.push(_media);\n      }\n    }\n\n    // search and setup extra fields on travelplan\n    for (const fieldgroup of vtbSrcData.extraFieldValues) {\n      for (const field of fieldgroup.fields) {\n        const _field = new VtbExtraField();\n        _field.name = field.name.toLowerCase().replace(/\\s+/, '_');\n        _field.title = field.translated_name;\n        _field.value = field.value;\n        _field.type = field.field_type;\n\n        if (field.options && field.options.length >= 1) {\n          _field.options = field.options;\n        }\n\n        if (fieldgroup.name) {\n          _field.group_name = fieldgroup.name;\n        }\n\n        if (this._data.extra_fields[_field.name]) {\n          console.warn('Duplicate extra field', _field.name);\n        }\n\n        this._data.extra_fields[_field.name] = _field;\n      }\n    }\n\n    for (const segment of vtbSrcData.segments) {\n      console.info(\n        'Segment',\n        segment.vtbObjectId,\n        segment.typeId,\n        segment.typeName,\n        segment\n      );\n\n      if (!(segment.typeId in this._data.elements)) {\n        this._data.elements[segment.typeId] = new VtbElementGroup();\n      } else {\n        console.warn('Duplicate segment', segment.typeId);\n      }\n\n      // parse flight info elements\n      if (segment.flightInfo && segment.flightInfo.length >= 1) {\n        for (const flight of segment.flightInfo) {\n          const carrier = new VtbFlightCarrier();\n          carrier.name = flight.airlineObject.carrier_name;\n          carrier.code = flight.airlineObject.carrier_code;\n\n          const departure = new VtbFlight();\n          departure.date = dayjs.utc(\n            `${flight.departureDate} ${flight.departureTime}:00`\n          );\n          departure.IATA = flight.departureAirport;\n          departure.description = flight.departureAirportObject.description;\n          departure.country = flight.departureAirportObject.country;\n          departure.city = flight.departureAirportObject.city;\n          departure.location = new VtbGeoLocation();\n          departure.location.lat = flight.departureAirportObject.latitude;\n          departure.location.lng = flight.departureAirportObject.longitude;\n\n          const arrival = new VtbFlight();\n          arrival.date = dayjs.utc(\n            `${flight.arrivalDate} ${flight.arrivalTime}:00`\n          );\n          arrival.IATA = flight.arrivalAirport;\n          arrival.description = flight.arrivalAirportObject.description;\n          arrival.country = flight.arrivalAirportObject.country;\n          arrival.city = flight.arrivalAirportObject.city;\n          arrival.location = new VtbGeoLocation();\n          arrival.location.lat = flight.arrivalAirportObject.latitude;\n          arrival.location.lng = flight.arrivalAirportObject.longitude;\n\n          const flightElement = new VtbFlightData();\n          flightElement.carrier = carrier;\n          flightElement.departure = departure;\n          flightElement.arrival = arrival;\n          flightElement.flightnumber = flight.flightNumber;\n          flightElement.day = segment.day;\n\n          this._data.flight_elements.push(flightElement);\n        }\n      }\n\n      // parse car rental info\n      if (\n        segment.car_rental_elements &&\n        segment.car_rental_elements.length >= 1\n      ) {\n        console.info('has car_rental_elements');\n\n        let last_element: VtbElement | null = null;\n        for (const carElementData of segment.car_rental_elements) {\n          const car_element = this.parse_vtb_element(\n            carElementData.element,\n            segment.title\n          );\n\n          if (\n            last_element &&\n            car_element.optional &&\n            last_element.unit_id == car_element.unit_id\n          ) {\n            car_element.price_diff = car_element.price - last_element.price; // price difference between non-optional and optional elements\n          }\n\n          if (\n            !this._data.car_rental_elements.find(\n              (element) =>\n                element.object_id == car_element.object_id &&\n                element.day == car_element.day\n            )\n          ) {\n            this._data.car_rental_elements.push(car_element);\n\n            if (\n              !car_element.optional ||\n              (last_element && car_element.unit_id != last_element.unit_id)\n            ) {\n              last_element = car_element; // act as default element\n            }\n          }\n        }\n      }\n\n      this.parse_vtb_segment(segment);\n    }\n\n    return this._data;\n  }\n\n  protected parse_vtb_segment(\n    segment: any // eslint-disable-line @typescript-eslint/no-explicit-any\n  ) {\n    const element_group = new VtbElementGroup();\n    element_group.id = segment.vtbObjectId;\n    element_group.title = segment.title;\n    element_group.subtitle = segment.subTitle;\n    element_group.description = segment.content;\n    element_group.nights = segment.nights;\n    element_group.day = segment.dau;\n    element_group.type_id = segment.typeId;\n\n    for (const media_data of segment.media) {\n      const media = new VtbMedia();\n      media.src = media_data.url;\n      media.id = media_data.sourceId;\n      media.tags = media_data.tags;\n\n      element_group.media?.push(media);\n    }\n\n    let last_element: VtbElement | null = null;\n    for (const element of segment.elements) {\n      if (\n        element_group.elements &&\n        !(element.unitId in element_group.elements)\n      ) {\n        element_group.elements[element.unitId] = [];\n      }\n\n      const price_element: VtbElement = this.parse_vtb_element(\n        element,\n        segment.title\n      );\n\n      if (\n        last_element &&\n        price_element.optional &&\n        last_element.unit_id == price_element.unit_id\n      ) {\n        price_element.price_diff = price_element.price - last_element.price; // price difference between non-optional and optional elements\n      }\n\n      element_group.elements[element.unitId].push(price_element);\n\n      if (\n        !price_element.optional ||\n        (last_element && price_element.unit_id != last_element.unit_id)\n      ) {\n        last_element = price_element; // act as default element\n      }\n    }\n\n    this._data.elements[segment.typeId] = element_group;\n  }\n\n  protected parse_vtb_element(\n    element_data: any, // eslint-disable-line @typescript-eslint/no-explicit-any\n    grouptitle?: string\n  ) {\n    const vtb_element = new VtbElement();\n\n    vtb_element.id = element_data.id;\n    vtb_element.title = element_data.title;\n    vtb_element.subtitle = element_data.subTitle;\n    vtb_element.description = element_data.additionalText?.replace(\n      /^.*?<body[^>]+>(.*)<\\/body>.*$/g,\n      '$1'\n    );\n    vtb_element.optional = element_data.optional;\n    vtb_element.price = parseFloat(element_data.olPrices?.salesTotal || 0);\n    vtb_element.nights = element_data.flexNights || element_data.nights;\n    vtb_element.day = element_data.day;\n    vtb_element.unit_id = element_data.unitId;\n    vtb_element.grouptitle = grouptitle;\n    vtb_element.object_id = element_data.vtbObjectId;\n\n    if (element_data.media && element_data.media.length >= 1) {\n      for (const media_data of element_data.media) {\n        const media = new VtbMedia();\n\n        media.src = media_data.url;\n        media.id = media_data.sourceId;\n        media.tags = media_data.tags;\n\n        vtb_element.media?.push(media);\n      }\n    }\n\n    vtb_element.participants = [];\n    for (const participant_id of Object.keys(\n      element_data.olPrices?.participants\n    )) {\n      const participant_element = new VtbParticipantPrice();\n\n      participant_element.participant_id = participant_id;\n      participant_element.price = parseFloat(\n        element_data.olPrices.participants[participant_id]?.salesPrice || 0\n      );\n\n      vtb_element.participants.push(participant_element);\n    }\n\n    return vtb_element;\n  }\n}\n"]}