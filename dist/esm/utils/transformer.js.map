{"version":3,"file":"transformer.js","sourceRoot":"","sources":["../../../src/utils/transformer.ts"],"names":[],"mappings":"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","sourcesContent":["import dayjs from 'dayjs/esm/index.js';\nimport utc from 'dayjs/esm/plugin/utc/index.js';\nimport duration from 'dayjs/esm/plugin/duration/index.js'; // import plugin\n\ndayjs.locale('nl');\ndayjs.extend(utc);\ndayjs.extend(duration);\n\nimport {\n  VtbTravelPlanData,\n  VtbElement,\n  VtbElementGroup,\n  VtbExtraField,\n  VtbFlight,\n  VtbFlightCarrier,\n  VtbFlightData,\n  VtbGeoLocation,\n  VtbMedia,\n  VtbParticipant,\n  VtbParticipantPrice,\n  VtbParty,\n  VtbMapMarker,\n} from '../models.js';\n\nexport class VtbDataTransformer {\n  private _data = new VtbTravelPlanData();\n\n  parse_vtb_data(\n    vtbSrcData: any // eslint-disable-line @typescript-eslint/no-explicit-any\n  ) {\n    // search and setup base info\n    this._data.title = vtbSrcData.title;\n    this._data.subtitle = vtbSrcData.subTitle || '';\n    this._data.start_date = dayjs.utc(vtbSrcData.startDate);\n    this._data.end_date = dayjs.utc(vtbSrcData.endDate);\n    this._data.duration = vtbSrcData.totalDays;\n    this._data.sales_price =\n      vtbSrcData.salesPriceAfterRounding ?? vtbSrcData.salesPriceBeforeRounding;\n\n    // search and setup participants and parties\n    for (const party_id of Object.keys(vtbSrcData.participants)) {\n      const participants = vtbSrcData.participants[party_id];\n\n      const _party = new VtbParty();\n      _party.id = party_id;\n\n      for (const pax of participants) {\n        const _pax = new VtbParticipant();\n        _pax.id = Number(pax.id);\n\n        // temporary workaround\n        if (pax.age_calc_type != 'Adult') {\n          _pax.id = parseInt(String(50 + Math.random() * 100), 10);\n        }\n\n        _pax.title = pax.title;\n        _pax.name = pax.name;\n        _pax.prefix = pax.surname_prefix;\n        _pax.surname = pax.surname;\n        _pax.calc_type = pax.age_calc_type;\n\n        if (pax.birthdate) {\n          _pax.birthdate = dayjs.utc(pax.birthdate);\n        }\n\n        this._data.add_participant(_pax);\n        _party.participants?.push(_pax);\n      }\n\n      this._data.parties[party_id] = _party;\n    }\n\n    // search and setup covers (can be 0 or more!)\n    if (vtbSrcData.cover && vtbSrcData.cover.length >= 1) {\n      for (const src of vtbSrcData.cover) {\n        const _media = new VtbMedia();\n        _media.src = src.url;\n        _media.id = src.sourceId;\n        _media.tags = src.tags;\n\n        this._data.covers.push(_media);\n      }\n    }\n\n    for (const text_key of Object.keys(vtbSrcData.TSOrder.texts)) {\n      const _field = new VtbExtraField();\n      _field.name = text_key.toLowerCase().replace(/[\\s-]+/g, '_');\n      _field.value = vtbSrcData.TSOrder.texts[text_key];\n      if (this._data.extra_fields[_field.name]) {\n        console.warn('Duplicate text field', _field.name);\n      }\n      this._data.extra_fields[_field.name] = _field;\n    }\n\n    // search and setup extra fields on travelplan\n    for (const fieldgroup of vtbSrcData.extraFieldValues) {\n      for (const field of fieldgroup.fields) {\n        const _field = new VtbExtraField();\n        _field.name = field.name.toLowerCase().replace(/[\\s-]+/g, '_');\n        _field.title = field.translated_name;\n        _field.value = field.value;\n        _field.type = field.field_type;\n\n        if (field.options && field.options.length >= 1) {\n          _field.options = field.options;\n        }\n\n        if (fieldgroup.name) {\n          _field.group_name = fieldgroup.name;\n        }\n\n        if (this._data.extra_fields[_field.name]) {\n          console.warn('Duplicate extra field', _field.name);\n        }\n\n        this._data.extra_fields[_field.name] = _field;\n      }\n    }\n\n    for (const segment_data of vtbSrcData.segments) {\n      // console.info(\n      //   'Segment',\n      //   segment_data.vtbObjectId,\n      //   segment_data.typeId,\n      //   segment_data.title,\n      //   segment_data.day,\n      //   segment_data.nights\n      // );\n\n      // parse flight info elements\n      if (segment_data.flightInfo && segment_data.flightInfo.length >= 1) {\n        this.parse_flight_info(segment_data);\n      }\n\n      // parse car rental info\n      if (\n        segment_data.car_rental_elements &&\n        segment_data.car_rental_elements.length >= 1\n      ) {\n        // console.info('has car_rental_elements');\n\n        let last_element: VtbElement | null = null;\n        for (const carElementData of segment_data.car_rental_elements) {\n          const car_element = this.parse_vtb_element(\n            carElementData.element,\n            segment_data.title\n          );\n\n          if (\n            last_element &&\n            car_element.optional &&\n            last_element.unit_id == car_element.unit_id\n          ) {\n            car_element.price_diff = car_element.price - last_element.price; // price difference between non-optional and optional elements\n          }\n\n          if (\n            !this._data.car_rental_elements.find(\n              (element) =>\n                element.object_id == car_element.object_id &&\n                element.day == car_element.day\n            )\n          ) {\n            this._data.car_rental_elements.push(car_element);\n\n            if (\n              !car_element.optional ||\n              (last_element && car_element.unit_id != last_element.unit_id)\n            ) {\n              last_element = car_element; // act as default element\n            }\n          }\n        }\n      }\n\n      this._data.add_element_group(this.parse_vtb_segment(segment_data));\n    }\n\n    // console.info(this._data);\n\n    return this._data;\n  }\n\n  protected parse_flight_info(\n    segment_data: any // eslint-disable-line @typescript-eslint/no-explicit-any\n  ) {\n    for (const flight of segment_data.flightInfo) {\n      const carrier = new VtbFlightCarrier();\n      carrier.name =\n        flight.airlineObject.name || flight.airlineObject.carrier_name;\n      carrier.code =\n        flight.airlineObject.code || flight.airlineObject.carrier_code;\n\n      const departure = new VtbFlight();\n      departure.date = dayjs.utc(\n        `${flight.departureDate} ${flight.departureTime}:00`\n      );\n      departure.IATA = flight.departureAirport;\n      departure.description = flight.departureAirportObject.description;\n      departure.country = flight.departureAirportObject.country;\n      departure.city = flight.departureAirportObject.city;\n      departure.location = new VtbGeoLocation();\n      departure.location.lat = flight.departureAirportObject.latitude;\n      departure.location.lng = flight.departureAirportObject.longitude;\n\n      const arrival = new VtbFlight();\n      arrival.date = dayjs.utc(\n        `${flight.arrivalDate} ${flight.arrivalTime}:00`\n      );\n      arrival.IATA = flight.arrivalAirport;\n      arrival.description = flight.arrivalAirportObject.description;\n      arrival.country = flight.arrivalAirportObject.country;\n      arrival.city = flight.arrivalAirportObject.city;\n      arrival.location = new VtbGeoLocation();\n      arrival.location.lat = flight.arrivalAirportObject.latitude;\n      arrival.location.lng = flight.arrivalAirportObject.longitude;\n\n      const flightElement = new VtbFlightData();\n      flightElement.carrier = carrier;\n      flightElement.departure = departure;\n      flightElement.arrival = arrival;\n      flightElement.flightnumber = flight.flightNumber;\n      flightElement.duration = flight.duration;\n      flightElement.day = segment_data.day;\n\n      if (!flightElement.duration) {\n        flightElement.duration = dayjs\n          .duration(arrival.date.diff(departure.date))\n          .format('H:mmu');\n      }\n\n      this._data.add_flight_element(flightElement);\n    }\n  }\n\n  protected parse_vtb_segment(\n    segment_data: any // eslint-disable-line @typescript-eslint/no-explicit-any\n  ) {\n    const element_group = new VtbElementGroup();\n    element_group.id = segment_data.vtbObjectId;\n    element_group.title = segment_data.title;\n    element_group.subtitle = segment_data.subTitle;\n    element_group.description = segment_data.content || '';\n    element_group.day = segment_data.day;\n    element_group.nights = segment_data.nights;\n    element_group.type_id = segment_data.typeId;\n    element_group.unit_id = segment_data.unitId;\n\n    if (segment_data.date) {\n      element_group.startdate = dayjs(segment_data.date);\n    }\n    if (segment_data.endDate) {\n      element_group.enddate = dayjs(segment_data.endDate);\n    }\n\n    if (segment_data.flightInfo && segment_data.flightInfo.length >= 1) {\n      element_group.is_flight = true;\n    }\n\n    if (\n      segment_data.carRentalElements &&\n      segment_data.carRentalElements.length >= 1\n    ) {\n      element_group.is_carrental = true;\n    }\n\n    for (const media_data of segment_data.media) {\n      const media = new VtbMedia();\n      media.src = media_data.url;\n      media.id = media_data.sourceId;\n      media.tags = media_data.tags;\n\n      element_group.media.push(media);\n    }\n\n    let last_element: VtbElement | null = null;\n    for (const element_data of segment_data.elements) {\n      const vtb_element: VtbElement = this.parse_vtb_element(\n        element_data,\n        segment_data.title\n      );\n\n      if (\n        last_element &&\n        vtb_element.optional &&\n        last_element.unit_id == vtb_element.unit_id\n      ) {\n        // console.debug(\n        //   'Optional element: ',\n        //   vtb_element.title,\n        //   vtb_element.subtitle,\n        //   vtb_element.price,\n        //   last_element.price,\n        //   last_element.price - vtb_element.price\n        // );\n        vtb_element.price_diff = vtb_element.price - last_element.price; // price difference between non-optional and optional elements\n      }\n\n      element_group.add_element(vtb_element);\n\n      if (\n        !vtb_element.optional ||\n        (last_element && vtb_element.unit_id != last_element.unit_id)\n      ) {\n        // console.debug(\n        //   'set last element: ',\n        //   vtb_element.title,\n        //   vtb_element.subtitle,\n        //   vtb_element.price\n        // );\n        last_element = vtb_element; // act as default element\n      }\n    }\n\n    if (segment_data.maps) {\n      // console.debug('segment_data.maps', segment_data);\n      element_group.location = new VtbMapMarker();\n      element_group.location.lat = segment_data.maps.latitude;\n      element_group.location.lng = segment_data.maps.longitude;\n      element_group.location.zoom = segment_data.maps.zoom;\n    }\n\n    return element_group;\n  }\n\n  private re_body = /<body[^>]+>(.*)<\\/body>/g;\n  private re_style = /style=\"[^\"]+\"/gi;\n\n  protected parse_vtb_element(\n    element_data: any, // eslint-disable-line @typescript-eslint/no-explicit-any\n    grouptitle?: string\n  ) {\n    const vtb_element = new VtbElement();\n    // console.debug('element_data: ', element_data);\n    vtb_element.id = element_data.vtbObjectId;\n    vtb_element.title = element_data.title;\n    vtb_element.subtitle = element_data.subTitle;\n    // set element description, get all contents from the <body> and remove all style attributes\n    vtb_element.description = element_data.additionalText\n      ?.replace(this.re_body, '$1')\n      ?.replace(this.re_style, '');\n\n    vtb_element.additional_description = element_data.subAdditionalText\n      ?.replace(this.re_body, '$1')\n      ?.replace(this.re_style, '');\n\n    vtb_element.optional = element_data.optional;\n    vtb_element.price = parseFloat(element_data.olPrices?.salesTotal || 0);\n    vtb_element.nights = element_data.flexNights || element_data.nights;\n    vtb_element.day = element_data.day;\n    vtb_element.unit_id = element_data.unitId;\n    vtb_element.grouptitle = grouptitle;\n    vtb_element.object_id = element_data.vtbObjectId;\n\n    if (element_data.date) {\n      vtb_element.startdate = dayjs(element_data.date);\n    }\n    if (element_data.endDate) {\n      vtb_element.enddate = dayjs(element_data.endDate);\n    }\n\n    if (element_data.media && element_data.media.length >= 1) {\n      for (const media_data of element_data.media) {\n        const media = new VtbMedia();\n\n        media.src = media_data.url;\n        media.id = media_data.sourceId;\n        media.tags = media_data.tags;\n\n        vtb_element.media.push(media);\n      }\n    }\n\n    for (const participant_id of Object.keys(\n      element_data.olPrices?.participants\n    )) {\n      const participant_element_price = new VtbParticipantPrice();\n\n      participant_element_price.participant_id = Number(participant_id);\n      participant_element_price.price = parseFloat(\n        element_data.olPrices.participants[participant_id]?.salesPrice || 0\n      );\n\n      vtb_element.participant_prices.push(participant_element_price);\n    }\n\n    if (\n      element_data.maps &&\n      element_data.maps.enabled &&\n      element_data.maps.latitude != 0 &&\n      element_data.maps.longitude != 0\n    ) {\n      // console.debug('element_data.maps', element_data);\n\n      vtb_element.location = new VtbMapMarker();\n      vtb_element.location.lat = element_data.maps.latitude;\n      vtb_element.location.lng = element_data.maps.longitude;\n      vtb_element.location.zoom = element_data.maps.zoom || 16;\n      vtb_element.location.title = element_data.title;\n      vtb_element.location.content = element_data.additionalText;\n    }\n\n    return vtb_element;\n  }\n}\n"]}