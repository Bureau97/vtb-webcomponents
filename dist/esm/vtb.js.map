{"version":3,"file":"vtb.js","sourceRoot":"","sources":["../../src/vtb.ts"],"names":[],"mappings":"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","sourcesContent":["import {VtbConfig, VtbFilterConfig} from './utils/interfaces.js';\n\nimport {\n  VtbTravelPlanData,\n  VtbElement,\n  VtbElementGroup,\n  VtbMapMarkerGroup,\n  VtbExtraField,\n  VtbParticipant\n} from './models.js';\nimport {VtbMapMarkerConnectMode} from './utils/types.js';\nimport {VtbDataTransformer} from './utils/transformer.js';\nimport {VtbMapElement, VtbMapOptions} from './components/map.js';\nimport {\n  VtbFlightScheduleElement,\n  VtbFlightScheduleOptions\n} from './components/flightschedule.js';\n\nexport class Vtb {\n  private _data: any = {}; // eslint-disable-line @typescript-eslint/no-explicit-any\n  private _config?: VtbConfig;\n\n  constructor(vtb_config_options?: VtbConfig) {\n    if (vtb_config_options) {\n      this._config = vtb_config_options;\n    }\n  }\n\n  get is_live_preview(): boolean {\n    if (\n      window.location.search &&\n      window.location.search !== '' &&\n        /(\\?|&)key=([^&]*)/.test(window.location.search)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get title() {\n    return this._data.title;\n  }\n\n  get subtitle() {\n    return this._data.subtitle;\n  }\n\n  get covers() {\n    return this._data.covers;\n  }\n\n  get startdate() {\n    return this._data.start_date;\n  }\n\n  get enddate() {\n    return this._data.end_date;\n  }\n\n  get duration() {\n    return this._data.duration;\n  }\n\n  get days() {\n    return this.duration;\n  }\n\n  get nights() {\n    return this.duration - 1;\n  }\n\n  get sales_price() {\n    return this._data.sales_price;\n  }\n\n  get has_flightinfo(): boolean {\n    return this.flightinfo.length > 0;\n  }\n\n  get flight_info() {\n    return this.flightinfo;\n  }\n\n  get participants(): Array<VtbParticipant> {\n    return Object.values(this._data.participants);\n  }\n\n  get parties() {\n    return this._data.parties;\n  }\n\n  get flightinfo() {\n    return this._data.flight_elements;\n  }\n\n  get has_carrental(): boolean {\n    return this.carrental.length > 0;\n  }\n\n  get carrental() {\n    return this._data.car_rental_elements;\n  }\n\n  get extra_fields() {\n    return this._data.extra_fields;\n  }\n\n  public extra_field(name: string): VtbExtraField | null {\n    console.warn('deprecated call, use extra_fields getter instead');\n    return this._data.extra_fields[name] || null;\n  }\n\n  public extraField(name: string) {\n    console.warn('deprecated call, use extra_fields getter instead');\n    return this.extra_field(name);\n  }\n\n  public async load(travelplan_source_url: string): Promise<Vtb> {\n    // async load of travelplan json\n    console.info('Loading', travelplan_source_url);\n    const response = await fetch(travelplan_source_url);\n    const vtbSrcData = await response.json();\n    this.parse_vtb_data(vtbSrcData);\n    return this;\n  }\n\n  public parse_vtb_data(\n    vtbSrcData: any // eslint-disable-line @typescript-eslint/no-explicit-any\n  ): void {\n    const vtb_config = this._config;\n    this._data = new VtbDataTransformer(vtb_config).parse_vtb_data(vtbSrcData);\n  }\n\n  set data(data: VtbTravelPlanData) {\n    this._data = data;\n  }\n\n  get element_groups(): Array<VtbElementGroup> {\n    return this._data.element_groups;\n  }\n\n  public filter_groups(config: VtbFilterConfig): Array<VtbElementGroup> {\n    return this._data.filter_element_groups(config);\n  }\n\n  public filter_elements(config?: VtbFilterConfig): Array<VtbElement> {\n    return this._data.filter_elements(config);\n  }\n\n  public calculate_price(\n    config?: VtbFilterConfig,\n    elements?: Array<VtbElement>\n  ): number {\n    // console.info('calculate_price: ', config, elements);\n    if (!elements) {\n      elements = this.filter_elements(config ?? {});\n    }\n    // console.info('calculate_price: ', elements);\n\n    let total = 0.0;\n    for (const element of elements) {\n      if (element && !element.optional) {\n        total += element.price;\n      }\n    }\n\n    // console.info('calculate_price: ', total);\n\n    return total;\n  }\n\n  public map(\n    container_id: string,\n    filter_config: VtbFilterConfig,\n    map_options: VtbMapOptions\n  ): VtbMapElement {\n    const marker_group = this.filter_mapmarkers(filter_config);\n    marker_group.connectMarkers = map_options.connect_markers;\n    marker_group.connectMode =\n      map_options.connect_mode as VtbMapMarkerConnectMode;\n\n    const map = new VtbMapElement();\n    map.apiKey = map_options.api_key;\n    map.height = map_options.height || 500;\n    map.width = map_options.width;\n    map.zoom = map_options.zoom;\n    map.markergroups = [marker_group];\n\n    const container = document.getElementById(container_id);\n    container?.appendChild(map);\n\n    return map;\n  }\n\n  public filter_mapmarkers(config: VtbFilterConfig): VtbMapMarkerGroup {\n    const vtb_marker_elements: Array<VtbElement> = this.filter_elements(config);\n\n    const group = new VtbMapMarkerGroup();\n    for (const element of vtb_marker_elements) {\n      if (element.location) {\n        group.markers.push(element.location);\n      }\n    }\n\n    return group;\n  }\n\n  public flightschedule(\n    container_id: string,\n    filter_config?: VtbFilterConfig,\n    flightschedule_options?: VtbFlightScheduleOptions\n  ): VtbFlightScheduleElement {\n    // to do\n    // console.debug(\n    //   'flightschedule',\n    //   container_id,\n    //   filter_config,\n    //   flightschedule_options\n    // );\n\n    const flightschedule = new VtbFlightScheduleElement();\n    if (!filter_config) {\n      flightschedule.flightinfo = this.flightinfo;\n    } else {\n      // TODO:\n      console.debug(\n        'using filter config on flight element is not implemented yet'\n      );\n      // flightschedule.flightinfo = this.filter_flightinfo(filter_config);\n    }\n\n    if (flightschedule_options?.dateformat) {\n      flightschedule.dateformat = flightschedule_options.dateformat;\n    }\n\n    const container = document.getElementById(container_id);\n    container?.appendChild(flightschedule);\n\n    return flightschedule;\n  }\n\n  // public pricetable(\n  //   container_id: string,\n  //   filter_config?: VtbFilterConfig,\n  //   flightschedule_options?: VtbFlightScheduleOptions\n  // ) {\n  //   // to do\n  // }\n\n  /**\n   * merge element groups of possibly different types\n   * into one with all elements, media en concatted description\n   * of those groups\n   *\n   * @param element_groups\n   * @returns\n   */\n  public merge_groups_by_day(\n    element_groups: Array<VtbElementGroup>\n  ): Array<VtbElementGroup> {\n    const ret: Array<VtbElementGroup> = [];\n\n    let last_group: VtbElementGroup | null = null;\n\n    for (const group of element_groups) {\n      // skip carrental groups ??\n      // if (group.is_carrental) {\n      //   continue;\n      // }\n\n      const current_group: VtbElementGroup = group.clone();\n\n      // if (group.elements.length <= 0) {\n      //   continue;\n      // }\n\n      if (!last_group) {\n        // console.info('set last group from current group', current_group);\n        last_group = current_group;\n        continue;\n      }\n\n      if (current_group.day == last_group.day) {\n        // console.info(\n        //   'current group day == last group day: ',\n        //   current_group.day\n        // );\n        // if the next group has the same day\n        // we add it its elements to the current group\n        const elements: Array<VtbElement> = current_group.elements;\n        for (const element of elements) {\n          last_group?.add_element(element);\n        }\n\n        // set title if no title was set\n        if (!last_group.title && current_group.title) {\n          last_group.title = current_group.title;\n        }\n\n        // concat description\n        if (current_group.description) {\n          last_group.description += current_group.description;\n        }\n\n        // set the nights as the highest number of nights\n        if (last_group.nights < current_group.nights) {\n          last_group.nights = current_group.nights;\n          last_group.enddate = current_group.enddate;\n        }\n\n        // merge all media\n        if (current_group.media.length > 0) {\n          last_group.media.push(...current_group.media);\n        }\n      } else {\n        ret.push(last_group);\n        last_group = current_group;\n      }\n    }\n\n    if (last_group && ret[ret.length - 1] !== last_group) {\n      ret.push(last_group);\n    }\n\n    return ret;\n  }\n}\n"]}