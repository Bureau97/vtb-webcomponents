{"version":3,"file":"vtb.js","sourceRoot":"","sources":["../../src/vtb.ts"],"names":[],"mappings":"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","sourcesContent":["import {VtbFilterConfig} from './utils/interfaces.js';\n\nimport {\n  VtbTravelPlanData,\n  VtbElement,\n  VtbElementGroup,\n  VtbMapMarkerGroup,\n  VtbExtraField,\n  VtbParticipant,\n} from './models.js';\nimport {VtbMapMarkerConnectMode} from './utils/types.js';\nimport {VtbDataTransformer} from './utils/transformer.js';\nimport {VtbMapElement, VtbMapOptions} from './components/map.js';\nimport {\n  VtbFlightScheduleElement,\n  VtbFlightScheduleOptions,\n} from './components/flightschedule.js';\n\nexport class Vtb {\n  private _data: any = {}; // eslint-disable-line @typescript-eslint/no-explicit-any\n\n  constructor(vtb_parsed_data?: VtbTravelPlanData) {\n    if (vtb_parsed_data) {\n      this._data = vtb_parsed_data;\n    }\n  }\n\n  get title() {\n    return this._data.title;\n  }\n\n  get subtitle() {\n    return this._data.subtitle;\n  }\n\n  get covers() {\n    return this._data.covers;\n  }\n\n  get startdate() {\n    return this._data.start_date;\n  }\n\n  get enddate() {\n    return this._data.end_date;\n  }\n\n  get duration() {\n    return this._data.duration;\n  }\n\n  get days() {\n    return this.duration;\n  }\n\n  get nights() {\n    return this.duration - 1;\n  }\n\n  get sales_price() {\n    return this._data.sales_price;\n  }\n\n  get has_flightinfo(): boolean {\n    return this.flightinfo.length > 0;\n  }\n\n  get flight_info() {\n    return this.flightinfo;\n  }\n\n  get participants(): Array<VtbParticipant> {\n    return Object.values(this._data.participants);\n  }\n\n  get parties() {\n    return this._data.parties;\n  }\n\n  get flightinfo() {\n    return this._data.flight_elements;\n  }\n\n  get carrental() {\n    return this._data.car_rental_elements;\n  }\n\n  get extra_fields() {\n    return this._data.extra_fields;\n  }\n\n  public extra_field(name: string): VtbExtraField | null {\n    return this._data.extra_fields[name] || null;\n  }\n\n  public extraField(name: string) {\n    return this.extra_field(name);\n  }\n\n  public async load(travelplan_source_url: string): Promise<Vtb> {\n    // async load of travelplan json\n    console.info('Loading', travelplan_source_url);\n    const response = await fetch(travelplan_source_url);\n    const vtbSrcData = await response.json();\n    this.parse_vtb_data(vtbSrcData);\n    // console.info(this._data);\n    return this;\n  }\n\n  public parse_vtb_data(\n    vtbSrcData: any // eslint-disable-line @typescript-eslint/no-explicit-any\n  ): void {\n    this._data = new VtbDataTransformer().parse_vtb_data(vtbSrcData);\n  }\n\n  get element_groups(): Array<VtbElementGroup> {\n    return this._data.element_groups;\n  }\n\n  public filter_groups(config: VtbFilterConfig): Array<VtbElementGroup> {\n    return this._data.filter_element_groups(config);\n  }\n\n  public filter_elements(config?: VtbFilterConfig): Array<VtbElement> {\n    return this._data.filter_elements(config);\n  }\n\n  public calculate_price(\n    config?: VtbFilterConfig,\n    elements?: Array<VtbElement>\n  ): number {\n    // console.info('calculate_price: ', config, elements);\n    if (!elements) {\n      elements = this.filter_elements(config ?? {});\n    }\n    // console.info('calculate_price: ', elements);\n\n    let total = 0.0;\n    for (const element of elements) {\n      if (element && !element.optional) {\n        total += element.price;\n      }\n    }\n\n    // console.info('calculate_price: ', total);\n\n    return total;\n  }\n\n  public map(\n    container_id: string,\n    filter_config: VtbFilterConfig,\n    map_options: VtbMapOptions\n  ): VtbMapElement {\n    const marker_group = this.filter_mapmarkers(filter_config);\n    marker_group.connectMarkers = map_options.connect_markers;\n    marker_group.connectMode =\n      map_options.connect_mode as VtbMapMarkerConnectMode;\n\n    const map = new VtbMapElement();\n    map.apiKey = map_options.api_key;\n    map.height = map_options.height || 500;\n    map.width = map_options.width;\n    map.zoom = map_options.zoom;\n    map.markergroups = [marker_group];\n\n    const container = document.getElementById(container_id);\n    container?.appendChild(map);\n\n    return map;\n  }\n\n  public filter_mapmarkers(config: VtbFilterConfig): VtbMapMarkerGroup {\n    const vtb_marker_elements: Array<VtbElement> = this.filter_elements(config);\n\n    const group = new VtbMapMarkerGroup();\n    for (const element of vtb_marker_elements) {\n      if (element.location) {\n        group.markers.push(element.location);\n      }\n    }\n\n    return group;\n  }\n\n  public flightschedule(\n    container_id: string,\n    filter_config?: VtbFilterConfig,\n    flightschedule_options?: VtbFlightScheduleOptions\n  ): VtbFlightScheduleElement {\n    // to do\n    console.debug(\n      'flightschedule',\n      container_id,\n      filter_config,\n      flightschedule_options\n    );\n\n    const flightschedule = new VtbFlightScheduleElement();\n    flightschedule.flightinfo = this.flightinfo;\n    if (flightschedule_options?.dateformat) {\n      flightschedule.dateformat = flightschedule_options.dateformat;\n    }\n\n    const container = document.getElementById(container_id);\n    container?.appendChild(flightschedule);\n\n    return flightschedule;\n  }\n\n  // public pricetable(\n  //   container_id: string,\n  //   filter_config?: VtbFilterConfig,\n  //   flightschedule_options?: VtbFlightScheduleOptions\n  // ) {\n  //   // to do\n  // }\n}\n"]}